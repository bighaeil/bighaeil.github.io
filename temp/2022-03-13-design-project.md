---
title: "프로젝트를 설계하다.(Back-End) - 1"
categories:
    - spring
    - design
last_modified_at: 2022-03-13T18:40:00
toc: true
toc_sticky: true
---

# Design Project

이번 포스트는 그렇게 작다고 그렇게 크다고 볼 수 없는 프로젝트를 수행하면서 느낀점을 적어보려고 한다.

아마 아는 만큼보이는 특성상 아래 내용이 전부 맞다고 할 수 없지만 지금까지 설계한 경험 중에는 가장 잘 **디자인** 되지 않았나 기대를 하는 부분이다.

(틀린 부분을 피드백 받고 싶은 욕구도 존재하기에 포스트하는 것도 있다는 것도 인정하는 부분이다.)

# step 1

# 문제 인식

나는 아래와 같은 사항을 받았고 이를 처리해야할 서버를 개발해야 한다.

> 사용자에게 원하는 정보를 생성해서 제공하는 유료 제품을 판매한다.  
> 유료 정보를 만드는 서버는 이미 만들어져 있고 결제 시스템 및 유료 상품도 이미 만들어져 있는 상태이다.
> 단 유료 정보를 만들기 위해서는 많은 연산이 필요하기 때문에 요청(API)을 하면 약 5 ~ 10분까지도 걸릴 수 있다.(해당 처리는 병렬로 이뤄져서 요청에 한계는 없다고 친다.)  
> 해당 요청이 끝나고 이후 피드백이 없기 때문에 해당요청이 끝났는지 알고 싶으면 상태체크(API)를 사용해야 한다.  
> 유료 상품이기 때문에 성공적으로 정보가 만들어졌으면 상품을 결제완료 처리한다.  
> 알림, 결제실패 등 부수적인 요소는 제외한다.

내가 받은 처리사항을 간단하게 적어봤다. 분명 내가 받은 사항은 이렇게 적지 않았는데 막상 적으니 그렇게 길지 않은 것 같다.

(처음부터 이렇게 간단하게 파악했다면 얼마나 좋았을까. 문제는 복잡한 문서와 여러 차례 회의로 합의와 결정이 이루어진 결과물이라는 것이다.)

# 분리와 분해

분명 요구사항은 엄청 많았었다. 위 몇 줄로 줄일 수 있었던 것은 이미 결과를 아는 이후라서 그런 것인가? 아니면 대외비로 암축했기 때문인가?

처음 문제를 받고 나서 의미를 알 수 없는 명칭과 알 수 없는 처리들이 존재했기 때문에 나는 내가 이해할 수 있는 언어로 바꿔야 했다.

심플한 것을 좋아한다. 그래 가장 심플한 것으로 표현하자.

> 단어

요구사항을 단어가 될때까지 잘라버리자.

사용자
 - ... (...은 당연하겠지만 대외비이며 하나 이상이겠다.)
 - 상품
 - - 결제
 - - 결제대기
 - - 결제완료
 - - 결제정보
 - - 결제내역
 - - ...
 - ...
 - 소개
 - 검색
 - ...
 - ...

유료정보
 - ...
 - API
 - - 요청 API
 - - 상태체크 API
 - - 결과 API
 - - 다운로드
 - - 사용내역
 - - ...
 - page
 - - 소개
 - - 확인
 - - 실패
 - - ...
 - 시뮬레이션
 - ...
 - ...

(~~시간이 되면 그림으로 옴겨야 겠다.~~)

# 정리

대충 혹은 이상하게 보인다면 맞다.(물론 위 내용도 약간은 정제된 내용이다.) 분명 대충적은 것이고 나만 이해하는 단어로 정리한 것이니 당연하다. 문서에서 표현하고자 하는 내용에 구현해야 하는 사항을 대표하는 단어로 적어보았다. 한가지 특이한 점은 그룹(group 또는 depth)이 존재한다. 요구사항에 대해서 그룹을 만들고 그것의 단계를 만들어 봤다.

위 작업을 하고나면 머리속으로 시각적으로 2가지가 정리가 된다.

하나는 DB를 설계할 수 있다.

다른 하나는 시나리오를 그릴 수 있다.

## DB

내 기준에 DB가 전부 다 지만 앞으로 설명할 DB만 소개한다.

```javascript
상품 {
    상태
}

구매 {
    상태
}

유료정보_요청 {
    요청
    상태
}

유료정보 {
    내용
}
```

## 시나리오

문서를 분석하면서 얻은 시나리오는 다음으로 요약될 것 같다.

시나리오 1
1. 사용자가 상품을 결제한다.
1. 사용자가 유료정보를 요청한다.
1. 유료정보를 만든다.
1. 주기적으로 완료됐는지 체크한다.

시나리오 2
1. 유료정보를 만드는데 실패한다.
1. 결제를 취소한다.

시나리오 3
1. 유료정보를 만드는데 성공한다.
1. 유료정보를 사용할 수 있는 정보로 만든다.
1. 상품사용을 완료한다.
1. 사용자가 유료정보를 확인한다.

시나리오 4
1. 유료정보를 만드는 것을 취소한다.
1. 결제를 취소한다.

# 서버

이제 내가 만들 서버가 정리가 된 것 같다.

내가 만들어야될 서버는 API 서버와 batch 서버(실제로는 스케줄러 사용)가 필요할 것 이다.

그럼 개발해야 하는 API는 무엇인가.

1. 상품을 결제하는 API
1. 유료정보를 요청하는 API
1. 유료정보가 완료되었는지 체크하는 API
1. 유료정보를 성공처리하는 API
1. 유료정보를 취소처리하는 API
1. 유료정보를 실패처리하는 API
1. 유료정보를 가져오는 API

만약 위 API에서 질문이 생긴다면. 정상이다.
수 많은 의문들 중에 하나를 끄집어 보자면  `1번 API`(유료정보가 완료되었는지 체크하는 API)를 수행하면 유료정보의 상태를 아는 것이니 바로 `성공`, `취소` 또는 `실패`처리하면 되는 것 아닌가요? 그러면 `4번 API`, `5번 API`, `6번 API` API 3개는 줄일 수 있는 것 아닌가요? 이는 다음에 설명하겠다.

일단 API를 살펴보자.

## 1번 API

이미 만들어져 있지만 확인만 해보자.

이 API는 누가 호출하는가? **사용자**가 요청한다.

누구에게 요청하는가? **API 서버**이다.

이 API로 무엇을 원하는가? 유료정보를 요청할 수 있는 **상품**을 GET

간단하다.

## 2번 API

이 API는 누가 호출하는가? **사용자**

누구에게 요청하는가? **API 서버**

무엇을 원하는가? 유료정보 생성 **서버 사용권**

따로 조건이 있나?(여기서 조건은 API의 filter 조건이 아니고 운영 조건이다.) **상품을 결제한 사용자**만 이용 가능

## 3번 API

이 API는 누가 호출하는가? **관리자** 또는 **batch 서버**

누구에게 요청하는가? **API 서버**

무엇을 원하는가? 유료정보 **처리 상태**

## 4번 API

이 API는 누가 호출하는가? **관리자** 또는 **batch 서버**

누구에게 요청하는가? **API 서버**

무엇을 원하는가? **유료정보**

## 5번 API

이 API는 누가 호출하는가? **관리자** 또는 **batch 서버**

누구에게 요청하는가? **API 서버**

무엇을 원하는가? **상품**

## 6번 API

이 API는 누가 호출하는가? **관리자** 또는 **batch 서버**

누구에게 요청하는가? **API 서버**

무엇을 원하는가? **상품**

## 7번 API

이 API는 누가 호출하는가? **사용자**

누구에게 요청하는가? **사용자**

무엇을 원하는가? **유료정보**

따로 조건이 있나? 유료정보를 사용할 **권리가 있는 사용자**
